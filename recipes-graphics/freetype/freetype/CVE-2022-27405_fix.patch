From 4c47777bb4944d40dd7c78c3127cc1c2f0db7f10 Mon Sep 17 00:00:00 2001
From: Alluri Revathi Bhavani <RevathiBhavani_Alluri@comcast.com>
Date: Mon, 13 Mar 2023 10:44:54 +0000
Subject: [PATCH] Date: March 19, 2022 From:
 22a0cccb4d9d002f33c1ba7a4b36812c7d4f46b5 Subject: [PATCH] CVE-2022-27405
 Source:
 https://gitlab.freedesktop.org/freetype/freetype/-/commit/22a0cccb4d9d002f33c1ba7a4b36812c7d4f46b5
 License: GPLV2 Upstream-Status:
 https://gitlab.freedesktop.org/freetype/freetype/-/commit/22a0cccb4d9d002f33c1ba7a4b36812c7d4f46b5
 Signed-off-by: Werner Lemberg / aallur481(RevathiBhavani_Alluri@comcast.com)

---
 src/base/ftobjs.c | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/src/base/ftobjs.c b/src/base/ftobjs.c
index 1b04261..5a56d6a 100644
--- a/src/base/ftobjs.c
+++ b/src/base/ftobjs.c
@@ -2388,6 +2388,15 @@
     FT_UNUSED( test_mac_fonts );
 #endif

+/* only use lower 31 bits together with sign bit */
+    if ( face_index > 0 )
+      face_index &= 0x7FFFFFFFL;
+    else
+    {
+      face_index &= 0x7FFFFFFFL;
+      face_index  = -face_index;
+    }
+

 #ifdef FT_DEBUG_LEVEL_TRACE
     FT_TRACE3(( "FT_Open_Face: " ));
