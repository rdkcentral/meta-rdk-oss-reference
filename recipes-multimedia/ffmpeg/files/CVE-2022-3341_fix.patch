Date: Nov 30, 2023
From: 9cf652cef49d74afe3d454f27d49eb1a1394951e
Subject: Patch ffmpeg to address CVE-2022-3341
Source:  Github  https://github.com/FFmpeg/FFmpeg/commit/9cf652cef49d74afe3d454f27d49eb1a1394951e
License:
Upstream-Status: Pending
Signed-off-by: kmarim851 <Kalidoss_Marimuthu@comcast.com>
---
Index: ffmpeg-4.2.2/libavformat/nutdec.c
===================================================================
--- ffmpeg-4.2.2.orig/libavformat/nutdec.c
+++ ffmpeg-4.2.2/libavformat/nutdec.c
@@ -346,8 +346,12 @@ static int decode_main_header(NUTContext
         ret = AVERROR(ENOMEM);
         goto fail;
     }
-    for (i = 0; i < stream_count; i++)
-        avformat_new_stream(s, NULL);
+    for (i = 0; i < stream_count; i++) {
+        if (!avformat_new_stream(s, NULL)) {
+            ret = AVERROR(ENOMEM);
+            goto fail;
+       	}
+    }
 
     return 0;
 fail:
@@ -793,19 +797,23 @@ static int nut_read_header(AVFormatConte
     NUTContext *nut = s->priv_data;
     AVIOContext *bc = s->pb;
     int64_t pos;
-    int initialized_stream_count;
+    int initialized_stream_count, ret;
 
     nut->avf = s;
 
     /* main header */
     pos = 0;
+    ret = 0;
     do {
+        if (ret == AVERROR(ENOMEM))
+            return ret;
+
         pos = find_startcode(bc, MAIN_STARTCODE, pos) + 1;
         if (pos < 0 + 1) {
             av_log(s, AV_LOG_ERROR, "No main startcode found.\n");
             goto fail;
         }
-    } while (decode_main_header(nut) < 0);
+    } while ((ret = decode_main_header(nut)) < 0);
 
     /* stream headers */
     pos = 0;
