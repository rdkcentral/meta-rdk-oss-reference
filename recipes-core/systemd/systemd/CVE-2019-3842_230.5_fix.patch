From d1a95e37c6b7fb08b6b12fb153995ef9e8719707 Mon Sep 17 00:00:00 2001
From: skondu363 <Srihariraghava_konduritirumala@comcast.com>
Date: Mon, 2 Sep 2024 10:08:50 +0000
Subject: [PATCH]
Source: upstream
Upstream-Status: Backport from [https://github.com/systemd/systemd/commit/83d4ab55336ff8a0643c6aa627b31e351a24040a]
CVE: CVE-2019-3842

Signed-off-by: skondu363 <Srihariraghava_konduritirumala@comcast.com>
---
 src/login/pam_systemd.c | 10 +++++-----
 1 file changed, 5 insertions(+), 5 deletions(-)

diff --git a/src/login/pam_systemd.c b/src/login/pam_systemd.c
index 4f023640f6..f59c841a9a 100644
--- a/src/login/pam_systemd.c
+++ b/src/login/pam_systemd.c
@@ -287,27 +287,27 @@ _public_ PAM_EXTERN int pam_sm_open_session(
 
         seat = pam_getenv(handle, "XDG_SEAT");
         if (isempty(seat))
-                seat = getenv("XDG_SEAT");
+                seat = secure_getenv("XDG_SEAT");
 
         cvtnr = pam_getenv(handle, "XDG_VTNR");
         if (isempty(cvtnr))
-                cvtnr = getenv("XDG_VTNR");
+                cvtnr = secure_getenv("XDG_VTNR");
 
         type = pam_getenv(handle, "XDG_SESSION_TYPE");
         if (isempty(type))
-                type = getenv("XDG_SESSION_TYPE");
+                type = secure_getenv("XDG_SESSION_TYPE");
         if (isempty(type))
                 type = type_pam;
 
         class = pam_getenv(handle, "XDG_SESSION_CLASS");
         if (isempty(class))
-                class = getenv("XDG_SESSION_CLASS");
+                class = secure_getenv("XDG_SESSION_CLASS");
         if (isempty(class))
                 class = class_pam;
 
         desktop = pam_getenv(handle, "XDG_SESSION_DESKTOP");
         if (isempty(desktop))
-                desktop = getenv("XDG_SESSION_DESKTOP");
+                desktop = secure_getenv("XDG_SESSION_DESKTOP");
 
         tty = strempty(tty);
 
