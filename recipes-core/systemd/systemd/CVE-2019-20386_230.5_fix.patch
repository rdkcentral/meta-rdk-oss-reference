From ab8ddaa85219ea1c96756f256c4ea3dd70873742 Mon Sep 17 00:00:00 2001
From: skondu363 <Srihariraghava_konduritirumala@comcast.com>
Date: Mon, 2 Sep 2024 09:17:47 +0000
Subject: [PATCH]
Source: upstream
Upstream-Status: Backport from [https://github.com/systemd/systemd/commit/b2774a3ae692113e1f47a336a6c09bac9cfb49ad]
CVE: CVE-2019-20386

Signed-off-by: skondu363 <Srihariraghava_konduritirumala@comcast.com>
---
 src/login/logind-button.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/src/login/logind-button.c b/src/login/logind-button.c
index 86d271d64d..828a6846e4 100644
--- a/src/login/logind-button.c
+++ b/src/login/logind-button.c
@@ -253,6 +253,7 @@ int button_open(Button *b) {
                 goto fail;
         }
 
+        b->io_event_source = sd_event_source_unref(b->io_event_source);
         r = sd_event_add_io(b->manager->event, &b->io_event_source, b->fd, EPOLLIN, button_dispatch, b);
         if (r < 0) {
                 log_error_errno(r, "Failed to add button event: %m");
