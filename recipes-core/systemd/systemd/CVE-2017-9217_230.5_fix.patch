From cf07d8d535e51637b7b1971d6e75ecda7b7666dc Mon Sep 17 00:00:00 2001
From: skondu363 <Srihariraghava_konduritirumala@comcast.com>
Date: Fri, 30 Aug 2024 09:16:30 +0000
Subject: [PATCH]
Source: upstream
Upstream-Status: Backport from [https://github.com/systemd/systemd/pull/6020/commits/9e74e781f176f3b930d9c202e20532f011a5d7bc]
CVE: CVE-2017-9217

Signed-off-by: skondu363 <Srihariraghava_konduritirumala@comcast.com>
---
 src/resolve/resolved-dns-packet.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/src/resolve/resolved-dns-packet.c b/src/resolve/resolved-dns-packet.c
index b7907bb511..fc9f6451f5 100644
--- a/src/resolve/resolved-dns-packet.c
+++ b/src/resolve/resolved-dns-packet.c
@@ -2219,6 +2219,9 @@ int dns_packet_is_reply_for(DnsPacket *p, const DnsResourceKey *key) {
         if (r < 0)
                 return r;
 
+        if (!p->question)
+                return 0;
+
         if (p->question->n_keys != 1)
                 return 0;
 
