Date: 27-April-2023
From: Kalidoss_Marimuthu@comcast.com
Source: Backport

See https://chromium.googlesource.com/webm/libwebp/+/907208f97ead639bd521cf355a2f203f462eade6

Index: libwebp-0.5.0/src/dec/idec.c
===================================================================
--- libwebp-0.5.0.orig/src/dec/idec.c
+++ libwebp-0.5.0/src/dec/idec.c
@@ -465,6 +465,12 @@ static VP8StatusCode DecodeRemaining(Web
         if (dec->num_parts_ == 1 && MemDataSize(&idec->mem_) > MAX_MB_SIZE) {
           return IDecError(idec, VP8_STATUS_BITSTREAM_ERROR);
         }
+	// Synchronize the threads.
+	if (dec->mt_method_ > 0) {
+          if (!WebPGetWorkerInterface()->Sync(&dec->worker_)) {
+            return IDecError(idec, VP8_STATUS_BITSTREAM_ERROR);
+	  }
+	}
         RestoreContext(&context, dec, token_br);
         return VP8_STATUS_SUSPENDED;
       }
