Date: 27-April-2023
From: Kalidoss_Marimuthu@comcast.com
Source: Backport

See https://chromium.googlesource.com/webm/libwebp/+/569001f19fc81fcb5ab358f587a54c62e7c4665c

Index: libwebp-0.5.0/src/dec/idec.c
===================================================================
--- libwebp-0.5.0.orig/src/dec/idec.c
+++ libwebp-0.5.0/src/dec/idec.c
@@ -276,10 +276,8 @@ static void RestoreContext(const MBConte
 
 static VP8StatusCode IDecError(WebPIDecoder* const idec, VP8StatusCode error) {
   if (idec->state_ == STATE_VP8_DATA) {
-    VP8Io* const io = &idec->io_;
-    if (io->teardown != NULL) {
-      io->teardown(io);
-    }
+    // Synchronize the thread, clean-up and check for errors.
+    VP8ExitCritical((VP8Decoder*)idec->dec_, &idec->io_);
   }
   idec->state_ = STATE_ERROR;
   return error;
