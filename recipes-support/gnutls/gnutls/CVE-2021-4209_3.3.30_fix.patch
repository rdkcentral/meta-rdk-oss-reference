From 30aaf45dc6f57d465a668c9070e47146c421bb0d Mon Sep 17 00:00:00 2001
From: skondu363 <Srihariraghava_konduritirumala@comcast.com>
Date: Thu, 3 Oct 2024 09:48:20 +0000
Subject: [PATCH]
Source: upstream
Upstream-Status:Backport from [https://gitlab.com/gnutls/gnutls/-/commit/3db352734472d851318944db13be73da61300568]
CVE: CVE-2021-4209

Signed-off-by: skondu363 <Srihariraghava_konduritirumala@comcast.com>
---
 lib/nettle/mac.c | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/lib/nettle/mac.c b/lib/nettle/mac.c
index cf4fd70..d253c0e 100644
--- a/lib/nettle/mac.c
+++ b/lib/nettle/mac.c
@@ -412,7 +412,9 @@ static int wrap_nettle_hash_fast(gnutls_digest_algorithm_t algo,
 	if (ret < 0)
 		return gnutls_assert_val(ret);
 
-	_NETTLE_UPDATE(ctx.update, &ctx, text_size, text);
+	if (text_size > 0) {
+	        _NETTLE_UPDATE(ctx.update, &ctx, text_size, text);
+	}
 	ctx.digest(&ctx, ctx.length, digest);
 
 	return 0;
