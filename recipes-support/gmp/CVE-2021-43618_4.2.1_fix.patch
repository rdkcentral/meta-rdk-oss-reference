From f7deca2c3a364f1aaaae37133416ce97bf3d551b Mon Sep 17 00:00:00 2001
From: skondu363 <Srihariraghava_konduritirumala@comcast.com>
Date: Wed, 8 Jan 2025 16:18:13 +0000
Subject: [PATCH]
From: Srihariraghava_konduritirumala@comcast.com
Source: upstream
        https://gmplib.org/repo/gmp-6.2/rev/561a9c25298e
CVE : CVE-2021-43618

Signed-off-by: skondu363 <Srihariraghava_konduritirumala@comcast.com>
---
 mpz/inp_raw.c | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/mpz/inp_raw.c b/mpz/inp_raw.c
index 735dcf3..5ab96bc 100644
--- a/mpz/inp_raw.c
+++ b/mpz/inp_raw.c
@@ -23,7 +23,7 @@ MA 02110-1301, USA. */
 #include "gmp.h"
 #include "gmp-impl.h"

-
+typedef unsigned long int        mp_bitcnt_t;
 /* NTOH_LIMB_FETCH fetches a limb which is in network byte order (ie. big
    endian) and produces a normal host byte order result. */

@@ -83,8 +83,11 @@ mpz_inp_raw (mpz_ptr x, FILE *fp)

   abs_csize = ABS (csize);

+  if (UNLIKELY (abs_csize > ~(mp_bitcnt_t) 0 / 8))
+      return 0; /* Bit size overflows */
+
   /* round up to a multiple of limbs */
-  abs_xsize = (abs_csize*8 + GMP_NUMB_BITS-1) / GMP_NUMB_BITS;
+  abs_xsize = BITS_TO_LIMBS ((mp_bitcnt_t) abs_csize * 8);

   if (abs_xsize != 0)
     {

