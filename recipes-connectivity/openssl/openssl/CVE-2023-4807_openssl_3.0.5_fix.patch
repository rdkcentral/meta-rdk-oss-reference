Date: Dec 30, 2023
From: 4bfac4471f53c4f74c8d81020beb938f92d84ca5
Subject: Patch openssl to address CVE-2023-4807
Source:  openssl.org  https://git.openssl.org/gitweb/?p=openssl.git;a=commitdiff;h=4bfac4471f53c4f74c8d81020beb938f92d84ca5
License:
Upstream-Status: Pending
Signed-off-by: kmarim851 <Kalidoss_Marimuthu@comcast.com>
---
Index: openssl-3.0.5/crypto/poly1305/asm/poly1305-x86_64.pl
===================================================================
--- openssl-3.0.5.orig/crypto/poly1305/asm/poly1305-x86_64.pl
+++ openssl-3.0.5/crypto/poly1305/asm/poly1305-x86_64.pl
@@ -195,7 +195,7 @@ $code.=<<___	if ($avx>1);
 	bt	\$`5+32`,%r9		# AVX2?
 	cmovc	%rax,%r10
 ___
-$code.=<<___	if ($avx>3);
+$code.=<<___	if ($avx>3 && !$win64);
 	mov	\$`(1<<31|1<<21|1<<16)`,%rax
 	shr	\$32,%r9
 	and	%rax,%r9
@@ -2724,7 +2724,7 @@ $code.=<<___;
 .cfi_endproc
 .size	poly1305_blocks_avx512,.-poly1305_blocks_avx512
 ___
-if ($avx>3) {
+if ($avx>3 && !$win64) {
 ########################################################################
 # VPMADD52 version using 2^44 radix.
 #
