Date: Dec 30, 2023
From: 02ac9c9420275868472f33b01def01218742b8bb
Subject: Patch openssl to address CVE-2023-1255
Source:  openssl.org  https://git.openssl.org/gitweb/?p=openssl.git;a=commitdiff;h=02ac9c9420275868472f33b01def01218742b8bb
License:
Upstream-Status: Pending
Signed-off-by: kmarim851 <Kalidoss_Marimuthu@comcast.com>
---
Index: openssl-3.0.5/CHANGES.md
===================================================================
--- openssl-3.0.5.orig/CHANGES.md
+++ openssl-3.0.5/CHANGES.md
@@ -30,6 +30,15 @@ breaking changes, and mappings for the l
 
 ### Changes between 3.0.4 and 3.0.5 [5 Jul 2022]
 
+ * Fixed buffer overread in AES-XTS decryption on ARM 64 bit platforms which
+   happens if the buffer size is 4 mod 5. This can trigger a crash of an
+   application using AES-XTS decryption if the memory just after the buffer
+   being decrypted is not mapped.
+   Thanks to Anton Romanov (Amazon) for discovering the issue.
+   ([CVE-2023-1255])
+
+   *Nevine Ebeid*
+
  * The OpenSSL 3.0.4 release introduced a serious bug in the RSA
    implementation for X86_64 CPUs supporting the AVX512IFMA instructions.
    This issue makes the RSA implementation with 2048 bit private keys
@@ -19258,6 +19267,7 @@ ndif
 
 <!-- Links -->
 
+[CVE-2023-1255]: https://www.openssl.org/news/vulnerabilities.html#CVE-2023-1255
 [CVE-2023-0466]: https://www.openssl.org/news/vulnerabilities.html#CVE-2023-0466
 [CVE-2022-2274]: https://www.openssl.org/news/vulnerabilities.html#CVE-2022-2274
 [CVE-2022-2097]: https://www.openssl.org/news/vulnerabilities.html#CVE-2022-2274
Index: openssl-3.0.5/crypto/aes/asm/aesv8-armx.pl
===================================================================
--- openssl-3.0.5.orig/crypto/aes/asm/aesv8-armx.pl
+++ openssl-3.0.5/crypto/aes/asm/aesv8-armx.pl
@@ -3293,7 +3293,7 @@ $code.=<<___	if ($flavour =~ /64/);
 .align	4
 .Lxts_dec_tail4x:
 	add	$inp,$inp,#16
-	vld1.32	{$dat0},[$inp],#16
+        tst     $tailcnt,#0xf
 	veor	$tmp1,$dat1,$tmp0
 	vst1.8	{$tmp1},[$out],#16
 	veor	$tmp2,$dat2,$tmp2
@@ -3302,6 +3302,8 @@ $code.=<<___	if ($flavour =~ /64/);
 	veor	$tmp4,$dat4,$tmp4
 	vst1.8	{$tmp3-$tmp4},[$out],#32
 
+        b.eq    .Lxts_dec_abort
+        vld1.32 {$dat0},[$inp],#16
 	b	.Lxts_done
 .align	4
 .Lxts_outer_dec_tail:
Index: openssl-3.0.5/NEWS.md
===================================================================
--- openssl-3.0.5.orig/NEWS.md
+++ openssl-3.0.5/NEWS.md
@@ -20,6 +20,8 @@ OpenSSL 3.0
 
 ### Major changes between OpenSSL 3.0.4 and OpenSSL 3.0.5 [5 Jul 2022]
 
+  * Fixed buffer overread in AES-XTS decryption on ARM 64 bit platforms
+    ([CVE-2023-1255])
   * Fixed heap memory corruption with RSA private key operation
     ([CVE-2022-2274])
   * Fixed AES OCB failure to encrypt some bytes on 32-bit x86 platforms
@@ -1408,6 +1410,7 @@ OpenSSL 0.9.x
 
 <!-- Links -->
 
+[CVE-2023-1255]: https://www.openssl.org/news/vulnerabilities.html#CVE-2023-1255
 [CVE-2023-0466]: https://www.openssl.org/news/vulnerabilities.html#CVE-2023-0466
 [CVE-2022-2274]: https://www.openssl.org/news/vulnerabilities.html#CVE-2022-2274
 [CVE-2022-2097]: https://www.openssl.org/news/vulnerabilities.html#CVE-2022-2274
